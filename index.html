<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Raid Planner – Perfect Nameplates</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #111;
        color: white;
        min-height: 100vh;
    }
    .top {
        min-height: 50vh;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 24px;
        padding: 20px;
        box-sizing: border-box;
    }
    .bottom {
        min-height: 50vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        border-top: 2px solid #333;
        background: #0d0d0d;
    }
    .party {
        width: 200px;
        background: #1e1e1e;
        border: 2px solid #444;
        border-radius: 10px;
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    .party h3 {
        text-align: center;
        margin: 0 0 6px 0;
        font-size: 15px;
        color: #aaa;
        font-weight: normal;
    }
    .slot {
        flex: 1;
        min-height: 38px;
        background: #252525;
        border: 1px dashed #444;
        border-radius: 6px;
        position: relative;
        overflow: hidden;
        cursor: pointer; /* better feedback on mobile */
    }
    .ghost {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #888;
        font-size: 14px;
        font-weight: 500;
        letter-spacing: 0.3px;
        text-shadow: 0 0 3px rgba(0,0,0,0.9);
        pointer-events: none;
        opacity: 0.75;
        text-align: center;
        padding: 0 8px;
        box-sizing: border-box;
        z-index: 1;
    }
    .player {
        background: #2ecc71;
        color: black;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 14px;
        cursor: grab;
        user-select: none;
        white-space: nowrap;
        touch-action: manipulation;
        box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }
    .player.selected {
        background: #f1c40f; /* yellow highlight when selected on mobile */
        box-shadow: 0 0 12px #f1c40f80;
    }
    .player.in-slot {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0 8px;
        border-radius: 0;
        background: rgba(231, 76, 60, 0.92);
        color: white;
        font-weight: bold;
        font-size: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        cursor: pointer; /* allow tap to return on mobile */
        box-shadow: none;
        z-index: 2;
    }
    #playerArea {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        max-width: 90%;
        justify-content: center;
        margin-top: 24px;
    }
    textarea {
        width: 340px;
        height: 140px;
        padding: 12px;
        font-size: 15px;
        background: #1a1a1a;
        color: #eee;
        border: 1px solid #555;
        border-radius: 8px;
        resize: vertical;
        font-family: inherit;
        margin-bottom: 16px;
    }
    textarea::placeholder {
        color: #777;
    }
    button#copyButton {
        margin-top: 20px;
        padding: 12px 28px;
        font-size: 16px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
    }
    button#copyButton:hover {
        background: #2980b9;
    }
</style>
</head>
<body>

<div class="top" id="partyArea"></div>

<div class="bottom">
    <textarea id="inputBox" placeholder="Paste raid member names here, one per line..."></textarea>
    <div id="playerArea"></div>
    
    <button id="copyButton">Copy Raid Setup</button>
</div>

<script>
// Polyfill (keep for desktop fallback / partial mobile support)
<script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>

<script>
const PARTY_NAMES = [
    ["Try2tank", "MrLutzu", "Quanchi", "Azurablood", "Katherelia", "DPS/Yonko"],
    ["Senti", "Moy", "Frequency", "Pyrvana", "Sungyshadow", "Schandour"],
    ["Boobienator", "Ceyslh", "Zenaj", "Kallikantzaros", "Raijinzen", "-"],
    ["Welgian", "Mara", "RobeGin", "omgdnzz", "Cirannon", "Vamadov"],
    [], []
];

const partyArea  = document.getElementById("partyArea");
const playerArea = document.getElementById("playerArea");
const inputBox   = document.getElementById("inputBox");
const copyButton = document.getElementById("copyButton");

let draggedPlayer = null;
let selectedPlayer = null; // for mobile tap mode

const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

// ── Create parties + slots ────────────────────────────────────────────────
for (let p = 0; p < 10; p++) {
    const party = document.createElement("div");
    party.className = "party";
    
    const title = document.createElement("h3");
    title.textContent = `Party ${p + 1}`;
    party.appendChild(title);

    for (let i = 0; i < 6; i++) {
        const slot = document.createElement("div");
        slot.className = "slot";

        const ghost = document.createElement("div");
        ghost.className = "ghost";
        ghost.textContent = PARTY_NAMES[p][i] || "—";
        slot.appendChild(ghost);

        // Desktop drag & drop
        slot.addEventListener("dragover", e => e.preventDefault());

        slot.addEventListener("drop", e => {
            e.preventDefault();
            if (!draggedPlayer) return;
            movePlayerToSlot(draggedPlayer, slot);
        });

        // Mobile tap to place / swap
        slot.addEventListener("click", () => {
            if (!isTouchDevice) return; // desktop keeps drag only
            if (selectedPlayer) {
                movePlayerToSlot(selectedPlayer, slot);
                clearSelection();
            }
        });

        // Double-click or tap assigned name → return to bottom (works on both)
        slot.addEventListener("dblclick", ejectFromSlot);
        if (isTouchDevice) {
            slot.addEventListener("click", e => {
                const bubble = slot.querySelector(".player.in-slot");
                if (bubble && e.target === bubble) {
                    ejectFromSlot();
                }
            });
        }

        party.appendChild(slot);
    }
    partyArea.appendChild(party);
}

// Bottom area drop (desktop)
playerArea.addEventListener("dragover", e => e.preventDefault());
playerArea.addEventListener("drop", e => {
    e.preventDefault();
    if (!draggedPlayer) return;
    returnToBottom(draggedPlayer);
});

// ── Player generation ─────────────────────────────────────────────────────
function generatePlayers() {
    playerArea.innerHTML = "";
    const text = inputBox.value.trim();
    if (!text) return;

    const names = text.split("\n")
        .map(n => n.trim())
        .filter(n => n.length > 0);

    names.sort((a,b) => a.localeCompare(b, undefined, {sensitivity: 'base'}));

    names.forEach(name => {
        const div = document.createElement("div");
        div.className = "player";
        div.textContent = name;
        div.draggable = true; // desktop

        // Desktop drag
        div.addEventListener("dragstart", e => {
            draggedPlayer = div;
            setTimeout(() => { div.style.display = "none"; }, 0);
        });

        div.addEventListener("dragend", () => {
            div.style.display = "";
            draggedPlayer = null;
        });

        // Mobile tap to select
        if (isTouchDevice) {
            div.addEventListener("click", e => {
                e.stopPropagation();
                if (selectedPlayer === div) {
                    clearSelection();
                } else {
                    clearSelection();
                    selectedPlayer = div;
                    div.classList.add("selected");
                }
            });
        }

        playerArea.appendChild(div);
    });
}

inputBox.addEventListener("input", generatePlayers);

// ── Helper functions ──────────────────────────────────────────────────────
function movePlayerToSlot(player, slot) {
    // Remove from current location
    const oldParent = player.parentElement;
    if (oldParent === playerArea) {
        playerArea.removeChild(player);
    } else if (oldParent.classList.contains("slot")) {
        oldParent.removeChild(player);
    }

    // Eject existing if any (send back to bottom)
    const existing = slot.querySelector(".player");
    if (existing) {
        existing.classList.remove("in-slot");
        existing.style.cssText = "";
        slot.removeChild(existing);
        playerArea.appendChild(existing);
    }

    // Place
    player.classList.add("in-slot");
    player.style.cssText = "";
    slot.appendChild(player);

    clearSelection();
}

function ejectFromSlot() {
    const slot = this; // clicked slot
    const bubble = slot.querySelector(".player.in-slot");
    if (!bubble) return;
    bubble.classList.remove("in-slot");
    bubble.style.cssText = "";
    slot.removeChild(bubble);
    playerArea.appendChild(bubble);
    clearSelection();
}

function returnToBottom(player) {
    if (player.parentElement.classList.contains("slot")) {
        player.parentElement.removeChild(player);
    }
    player.classList.remove("in-slot");
    player.style.cssText = "";
    playerArea.appendChild(player);
    clearSelection();
}

function clearSelection() {
    if (selectedPlayer) {
        selectedPlayer.classList.remove("selected");
        selectedPlayer = null;
    }
}

// Copy (only placed players)
copyButton.addEventListener("click", () => {
    const parties = document.querySelectorAll(".party");
    let output = "";

    parties.forEach((party, p) => {
        output += `Party ${p + 1}:\n`;
        const slots = party.querySelectorAll(".slot");
        let hasAny = false;

        slots.forEach(slot => {
            const player = slot.querySelector(".player.in-slot");
            if (player) {
                output += player.textContent.trim() + "\n";
                hasAny = true;
            } else {
                output += "\n";
            }
        });

        if (hasAny) output += "\n";
        else output += "— empty —\n\n";
    });

    output = output.trimEnd();

    navigator.clipboard.writeText(output).then(() => {
        const orig = copyButton.textContent;
        copyButton.textContent = "Copied!";
        setTimeout(() => copyButton.textContent = orig, 1800);
    }).catch(err => {
        alert("Copy failed\n\n" + output);
    });
});
</script>
</body>
</html>

